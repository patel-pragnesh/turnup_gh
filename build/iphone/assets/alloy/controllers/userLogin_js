function __processArg(e,i){var t=null;return e&&(t=e[i]||null,delete e[i]),t}function Controller(){function e(e){console.log(">>> Download Image Successful : "+e)}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="userLogin",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var i=this,t={},o={};i.__views.userLogin=Ti.UI.createWindow({backgroundColor:Alloy.CFG.Colors.BackgroundColor,opacity:1,width:Ti.UI.FILL,height:Ti.UI.FILL,layout:"vertical",navBarHidden:!0,id:"userLogin"}),i.__views.userLogin&&i.addTopLevelView(i.__views.userLogin),i.__views.__alloyId33=Ti.UI.createView({height:Ti.UI.SIZE,width:Ti.UI.FILL,backgroundColor:Alloy.CFG.Colors.MainColor,top:0,id:"__alloyId33"}),i.__views.userLogin.add(i.__views.__alloyId33),i.__views.AppWrapper=Ti.UI.createView({height:Ti.UI.SIZE,id:"AppWrapper"}),i.__views.__alloyId33.add(i.__views.AppWrapper),i.__views.mainTitle=Ti.UI.createLabel({font:{fontSize:20,fontFamily:"Jengle Jungallery"},height:44.4,color:"#FFF",left:"30",id:"mainTitle",text:"Login"}),i.__views.AppWrapper.add(i.__views.mainTitle),u?i.__views.mainTitle.addEventListener("click",u):o["$.__views.mainTitle!click!closeWindow"]=!0,i.__views.imgBack=Ti.UI.createImageView({left:5,width:30,height:30,right:5,id:"imgBack"}),i.__views.AppWrapper.add(i.__views.imgBack),u?i.__views.imgBack.addEventListener("click",u):o["$.__views.imgBack!click!closeWindow"]=!0,i.__views.__alloyId34=Ti.UI.createScrollView({height:Ti.UI.FILL,width:Ti.UI.FILL,layout:"vertical",id:"__alloyId34"}),i.__views.userLogin.add(i.__views.__alloyId34),i.__views.userLoginView=Ti.UI.createView({layout:"vertical",left:15,right:15,top:5,id:"userLoginView"}),i.__views.__alloyId34.add(i.__views.userLoginView),i.__views.__alloyId35=Ti.UI.createView({layout:"horizontal",width:Ti.UI.SIZE,height:Ti.UI.SIZE,top:5,left:"0",id:"__alloyId35"}),i.__views.userLoginView.add(i.__views.__alloyId35),i.__views.imgEmailLogin=Ti.UI.createImageView({top:15,width:15,height:15,left:5,right:5,id:"imgEmailLogin"}),i.__views.__alloyId35.add(i.__views.imgEmailLogin),i.__views.lblEmail=Ti.UI.createLabel({font:{fontSize:19,fontFamily:"BodoniFLF",fontWeight:"bold"},height:Ti.UI.SIZE,textAlign:"left",text:"Email",top:"9",color:"#464646",id:"lblEmail"}),i.__views.__alloyId35.add(i.__views.lblEmail),i.__views.txtEmail=Ti.UI.createTextField({top:5,width:"98%",left:"1%",right:"1%",borderWidth:1,borderColor:Alloy.CFG.Colors.MainColor,backgroundColor:"#EEE",color:"#222",font:{fontFamily:"BodoniFLF"},borderRadius:3,height:40,paddingLeft:5,paddingRight:5,id:"txtEmail",hintText:"Email"}),i.__views.userLoginView.add(i.__views.txtEmail),i.__views.__alloyId36=Ti.UI.createView({layout:"horizontal",width:Ti.UI.SIZE,height:Ti.UI.SIZE,top:5,left:"0",id:"__alloyId36"}),i.__views.userLoginView.add(i.__views.__alloyId36),i.__views.imgPasswordLogin=Ti.UI.createImageView({top:15,width:20,height:20,left:5,right:5,id:"imgPasswordLogin"}),i.__views.__alloyId36.add(i.__views.imgPasswordLogin),i.__views.lblPassword=Ti.UI.createLabel({font:{fontSize:19,fontFamily:"BodoniFLF",fontWeight:"bold"},height:Ti.UI.SIZE,textAlign:"left",text:"Password",top:"13",color:"#464646",id:"lblPassword"}),i.__views.__alloyId36.add(i.__views.lblPassword),i.__views.txtPassword=Ti.UI.createTextField({top:5,width:"98%",left:"1%",right:"1%",borderWidth:1,borderColor:Alloy.CFG.Colors.MainColor,backgroundColor:"#EEE",color:"#222",font:{fontFamily:"BodoniFLF"},borderRadius:3,height:40,paddingLeft:5,paddingRight:5,id:"txtPassword",hintText:"Password",passwordMask:"true"}),i.__views.userLoginView.add(i.__views.txtPassword),i.__views.btnLogin=Ti.UI.createButton({font:{fontSize:18,fontFamily:"BodoniFLF"},height:33.3,top:20,bottom:10,width:"98%",left:"1%",right:"1%",backgroundColor:Alloy.CFG.Colors.MainColor,backgroundSelectedColor:Alloy.CFG.Colors.MainColor_Dark,borderColor:Alloy.CFG.Colors.MainPressedColor,color:Alloy.CFG.Colors.TextColor,backgroundImage:"null",selectedColor:"#AAA",id:"btnLogin",title:" Login "}),i.__views.userLoginView.add(i.__views.btnLogin),w?i.__views.btnLogin.addEventListener("click",w):o["$.__views.btnLogin!click!openUserLogin"]=!0,i.__views.btnRegister=Ti.UI.createButton({font:{fontSize:18,fontFamily:"BodoniFLF"},height:33.3,top:20,bottom:10,width:"98%",left:"1%",right:"1%",backgroundColor:Alloy.CFG.Colors.MainColor,backgroundSelectedColor:Alloy.CFG.Colors.MainColor_Dark,borderColor:Alloy.CFG.Colors.MainPressedColor,color:Alloy.CFG.Colors.TextColor,backgroundImage:"null",selectedColor:"#AAA",id:"btnRegister",title:" Register "}),i.__views.userLoginView.add(i.__views.btnRegister),p?i.__views.btnRegister.addEventListener("click",p):o["$.__views.btnRegister!click!openUserRegister"]=!0,i.__views.btnForgot=Ti.UI.createButton({font:{fontSize:18,fontFamily:"BodoniFLF"},height:33.3,top:10,bottom:10,width:"98%",left:"1%",right:"1%",backgroundColor:Alloy.CFG.Colors.MainColor,backgroundSelectedColor:Alloy.CFG.Colors.MainColor_Dark,borderColor:Alloy.CFG.Colors.MainPressedColor,color:Alloy.CFG.Colors.TextColor,backgroundImage:"null",selectedColor:"#AAA",id:"btnForgot",title:" Forgot Password "}),i.__views.userLoginView.add(i.__views.btnForgot),y?i.__views.btnForgot.addEventListener("click",y):o["$.__views.btnForgot!click!openForgotPassword"]=!0,t.destroy=function(){},_.extend(i,i.__views);var r=arguments[0]||{},a=require("platformSupport"),l=require("animation"),n=require("icomoonlib"),s=require("loader"),d=require("validationRules"),c=require("psdialog"),g=Alloy.Collections.users,m=0,h=require("loadingWindow");h.endLoading(),a.isiOS7Plus()&&(i.AppWrapper.top=20);var u=function(){l.out(i.userLogin)},w=function(){if(I())if(1==Titanium.Network.online){var e={email:i.txtEmail.value.toLowerCase(),password:i.txtPassword.value};h.startLoading();var t={callbackFunction:v,url:Alloy.CFG.Urls.baseURL+Alloy.CFG.Urls.postUserLogin,payload:e};s.post(t)}else c.loadCustomDialog("Log In",Alloy.CFG.Languages.offlineMessage)},v=function(i){if(console.log("Login Success. Need to store at Local DB."),null==i.error){if(null!=i){if(Ti.App.fireEvent("refreshMenu"),""!=i.profile_photo)if(1==Titanium.Network.online){var t={callbackFunction:e,urlDownload:Alloy.CFG.Urls.imagePathURL+i.profile_photo,fileName:i.profile_photo};s.downloadFileToApp(t)}else console.log(">>> Lacking Connection During Profile Photo Download");if(""!=i.background_photo)if(1==Titanium.Network.online){var t={callbackFunction:e,urlDownload:Alloy.CFG.Urls.imagePathURL+i.background_photo,fileName:i.background_photo};s.downloadFileToApp(t)}else console.log(">>> Lacking Connection During Profile Background Download");var o=Alloy.createModel("users",{id:i.id,username:i.username,email:i.email,about_me:i.about_me,is_banned:i.is_banned,profile_photo:i.profile_photo,background_photo:i.background_photo});if(g.add(o),o.save(),g.fetch(),Ti.App.Properties.setString("userId",i.id),u(),0==r.item_id)u();else{var a=Alloy.createController("review",r).getView();l.in(a)}h.endLoading()}}else c.loadCustomDialog("Log In",i.error.message)},I=function(){return""==i.txtEmail.value?(d.validationFailAction(i.txtEmail),m=0,!1):d.validateEmail(i.txtEmail.value)?""==i.txtPassword.value?(d.validationFailAction(i.txtPassword),m=0,!1):!0:(d.validationFailAction(i.txtEmail),m=0,!1)},p=function(){u(),h.startLoading();var e={item_id:r.item_id,loadReview:r.loadReview},i=Alloy.createController("userRegister",e).getView();l.in(i)},y=function(){u(),h.startLoading();var e={item_id:r.item_id},i=Alloy.createController("userForgot",e).getView();l.in(i)};i.txtEmail.addEventListener("change",function(){0==m&&(d.backToNormal(i.txtEmail),m=1)}),i.txtPassword.addEventListener("change",function(){0==m&&(d.backToNormal(i.txtPassword),m=1)});var f=function(){var e=n.getIcon("panacea","envelope",35,{color:Alloy.CFG.Colors.IconColor});i.imgEmailLogin.image=e;var t=n.getIcon("panacea","lock",35,{color:Alloy.CFG.Colors.IconColor});i.imgPasswordLogin.image=t;var o=n.getIcon("panacea","back",35,{color:Alloy.CFG.Colors.IconWhite});i.imgBack.image=o},T=function(){i.lblEmail.text=Alloy.CFG.Languages.lblEmail,i.lblPassword.text=Alloy.CFG.Languages.lblPassword,i.btnLogin.title=Alloy.CFG.Languages.btnLogin,i.btnRegister.title=Alloy.CFG.Languages.btnRegister,i.btnForgot.title=Alloy.CFG.Languages.btnForgot},L=function(){f(),T(),l.slowlyAppear(i.userLoginView)};i.userLogin.addEventListener("open",function(){h.endLoading(),L()}),o["$.__views.mainTitle!click!closeWindow"]&&i.__views.mainTitle.addEventListener("click",u),o["$.__views.imgBack!click!closeWindow"]&&i.__views.imgBack.addEventListener("click",u),o["$.__views.btnLogin!click!openUserLogin"]&&i.__views.btnLogin.addEventListener("click",w),o["$.__views.btnRegister!click!openUserRegister"]&&i.__views.btnRegister.addEventListener("click",p),o["$.__views.btnForgot!click!openForgotPassword"]&&i.__views.btnForgot.addEventListener("click",y),_.extend(i,t)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;