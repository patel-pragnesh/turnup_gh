function ucfirst(i){return i?i[0].toUpperCase()+i.substr(1):i}function addNamespace(i){return(CONST.IMPLICIT_NAMESPACES[i]||CONST.NAMESPACE_DEFAULT)+"."+i}function processStyle(i,t,e,o,s){o=o||{},o.classes=e,t.apiName&&(o.apiName=t.apiName),t.id&&(o.id=t.id),t.applyProperties(exports.createStyle(i,o,s))}function isTabletFallback(){return Math.min(Ti.Platform.displayCaps.platformHeight,Ti.Platform.displayCaps.platformWidth)>=700}function deepExtend(){var i,t,e,o,s,r,l=arguments[0]||{},a=1,y=arguments.length,n=!1;for("boolean"==typeof l&&(n=l,l=arguments[1]||{},a=2),"object"==typeof l||_.isFunction(l)||(l={});y>a;a++)if(i=arguments[a],null!=i){"string"==typeof i&&(i=i.split(""));for(t in i)e=l[t],o=i[t],l!==o&&(n&&o&&(_.isObject(o)&&!_.has(o,"apiName")||(s=_.isArray(o)))&&!o.colors?(s?(s=!1,r=e&&_.isArray(e)?e:[]):r=_.isDate(o)?new Date(o.valueOf()):e&&_.isObject(e)?e:{},l[t]=deepExtend(n,r,o)):"undefined"!=typeof o?l[t]=o:o.colors&&(l[t]=o))}return l}var _=require("alloy/underscore")._,Backbone=require("alloy/backbone"),CONST=require("alloy/constants");exports.version="1.5.1",exports._=_,exports.Backbone=Backbone;var DEFAULT_WIDGET="widget",TI_VERSION=Ti.version,MW320_CHECK=!1,IDENTITY_TRANSFORM=void 0,RESET={bottom:null,left:null,right:null,top:null,height:null,width:null,shadowColor:null,shadowOffset:null,backgroundImage:null,backgroundRepeat:null,center:null,layout:null,backgroundSelectedColor:null,backgroundSelectedImage:null,opacity:1,touchEnabled:!0,enabled:!0,horizontalWrap:!0,zIndex:0,backgroundColor:null,font:null,visible:!0,color:null,transform:null,backgroundGradient:{},borderColor:"transparent",borderRadius:0,borderWidth:0};RESET=_.extend(RESET,{backgroundLeftCap:0,backgroundTopCap:0}),exports.M=function(i,t,e){var o,s=(t||{}).config||{},r=s.adapter||{},l={},a={};r.type?(o=require("alloy/sync/"+r.type),l.sync=function(i,t,e){o.sync(i,t,e)}):l.sync=function(i,t){Ti.API.warn("Execution of "+i+"#sync() function on a model that does not support persistence"),Ti.API.warn("model: "+JSON.stringify(t.toJSON()))},l.defaults=s.defaults,e&&(a.migrations=e),o&&_.isFunction(o.beforeModelCreate)&&(s=o.beforeModelCreate(s,i)||s);var y=Backbone.Model.extend(l,a);return y.prototype.config=s,_.isFunction(t.extendModel)&&(y=t.extendModel(y)||y),o&&_.isFunction(o.afterModelCreate)&&o.afterModelCreate(y,i),y},exports.C=function(i,t,e){var o,s={model:e},r=(e?e.prototype.config:{})||{};r.adapter&&r.adapter.type?(o=require("alloy/sync/"+r.adapter.type),s.sync=function(i,t,e){o.sync(i,t,e)}):s.sync=function(i,t){Ti.API.warn("Execution of "+i+"#sync() function on a collection that does not support persistence"),Ti.API.warn("model: "+JSON.stringify(t.toJSON()))};var l=Backbone.Collection.extend(s);return l.prototype.config=r,_.isFunction(t.extendCollection)&&(l=t.extendCollection(l)||l),o&&_.isFunction(o.afterCollectionCreate)&&o.afterCollectionCreate(l),l},exports.UI={},exports.UI.create=function(controller,apiName,opts){opts=opts||{};var baseName,ns,parts=apiName.split(".");if(1===parts.length)baseName=apiName,ns=opts.ns||CONST.IMPLICIT_NAMESPACES[baseName]||CONST.NAMESPACE_DEFAULT;else{if(!(parts.length>1))throw"Alloy.UI.create() failed: No API name was given in the second parameter";baseName=parts[parts.length-1],ns=parts.slice(0,parts.length-1).join(".")}opts.apiName=ns+"."+baseName,baseName=baseName[0].toUpperCase()+baseName.substr(1);var style=exports.createStyle(controller,opts);return eval(ns)["create"+baseName](style)},exports.createStyle=function(i,t,e){var o,s;if(!t)return{};o=_.isArray(t.classes)?t.classes.slice(0):_.isString(t.classes)?t.classes.split(/\s+/):[],s=t.apiName,s&&-1===s.indexOf(".")&&(s=addNamespace(s));var r;r=require(i&&_.isObject(i)?"alloy/widgets/"+i.widgetId+"/styles/"+i.name:"alloy/styles/"+i);var l,a,y={};for(l=0,a=r.length;a>l;l++){var n=r[l],d=n.key;if(n.isApi&&-1===d.indexOf(".")&&(d=(CONST.IMPLICIT_NAMESPACES[d]||CONST.NAMESPACE_DEFAULT)+"."+d),n.isId&&t.id&&n.key===t.id||n.isClass&&_.contains(o,n.key));else{if(!n.isApi)continue;if(-1===n.key.indexOf(".")&&(n.key=addNamespace(n.key)),n.key!==s)continue}n.queries&&n.queries.formFactor&&!Alloy[n.queries.formFactor]||deepExtend(!0,y,n.style)}var p=_.omit(t,[CONST.CLASS_PROPERTY,CONST.APINAME_PROPERTY]);return deepExtend(!0,y,p),y[CONST.CLASS_PROPERTY]=o,y[CONST.APINAME_PROPERTY]=s,MW320_CHECK&&delete y[CONST.APINAME_PROPERTY],e?_.defaults(y,e):y},exports.addClass=function(i,t,e,o){if(!e)return void(o&&(MW320_CHECK&&delete o.apiName,t.applyProperties(o)));var s=t[CONST.CLASS_PROPERTY]||[],r=s.length;e=_.isString(e)?e.split(/\s+/):e;var l=_.union(s,e||[]);return r===l.length?void(o&&(MW320_CHECK&&delete o.apiName,t.applyProperties(o))):void processStyle(i,t,l,o)},exports.removeClass=function(i,t,e,o){e=e||[];var s=t[CONST.CLASS_PROPERTY]||[],r=s.length;if(!r||!e.length)return void(o&&(MW320_CHECK&&delete o.apiName,t.applyProperties(o)));e=_.isString(e)?e.split(/\s+/):e;var l=_.difference(s,e);return r===l.length?void(o&&(MW320_CHECK&&delete o.apiName,t.applyProperties(o))):void processStyle(i,t,l,o,RESET)},exports.resetClass=function(i,t,e,o){e=e||[],e=_.isString(e)?e.split(/\s+/):e,processStyle(i,t,e,o,RESET)},exports.createWidget=function(i,t,e){return"undefined"!=typeof t&&null!==t&&_.isObject(t)&&!_.isString(t)&&(e=t,t=DEFAULT_WIDGET),new(require("alloy/widgets/"+i+"/controllers/"+(t||DEFAULT_WIDGET)))(e)},exports.createController=function(i,t){return new(require("alloy/controllers/"+i))(t)},exports.createModel=function(i,t){return new(require("alloy/models/"+ucfirst(i)).Model)(t)},exports.createCollection=function(i,t){return new(require("alloy/models/"+ucfirst(i)).Collection)(t)},exports.isTablet=function(){return"ipad"===Ti.Platform.osname}(),exports.isHandheld=!exports.isTablet,exports.Globals={},exports.Models={},exports.Models.instance=function(i){return exports.Models[i]||(exports.Models[i]=exports.createModel(i))},exports.Collections={},exports.Collections.instance=function(i){return exports.Collections[i]||(exports.Collections[i]=exports.createCollection(i))},exports.CFG=require("alloy/CFG");